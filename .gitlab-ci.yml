# You can override the included template(s) by including variable overrides
# SAST customization: https://docs.gitlab.com/ee/user/application_security/sast/#customizing-the-sast-settings
# Secret Detection customization: https://docs.gitlab.com/ee/user/application_security/secret_detection/#customizing-settings
# Dependency Scanning customization: https://docs.gitlab.com/ee/user/application_security/dependency_scanning/#customizing-the-dependency-scanning-settings
# Note that environment variables can be set in several places
# See https://docs.gitlab.com/ee/ci/variables/#cicd-variable-precedence
variables:
  GIT_STRATEGY: none
  GIT_DEPTH: '1'
  GIT_LFS_SKIP_SMUDGE: '1'
default:
  image: ruby:alpine
  tags:
  - gitlab-org
workflow:
  rules:
  - if: "$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH"
pages:
  before_script:
  - apk add -U --no-cache git git-lfs
  - git init
  - git remote add origin $CI_REPOSITORY_URL
  - git fetch --depth $GIT_DEPTH origin $CI_COMMIT_SHA
  - git checkout FETCH_HEAD
  script:
  - git lfs pull -I 'hosted/'
  - ruby specscript.rb
  artifacts:
    paths:
    - public
    expire_in: 1 week
  rules:
  - changes:
    - hosted/**/*
include:
- template: Security/Dependency-Scanning.gitlab-ci.yml
